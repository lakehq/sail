syntax = "proto3";

package sail.worker;

message TaskStreamTicket {
  string channel = 1;
}

message WorkerLocation {
  uint64 worker_id = 1;
  string host = 2;
  uint32 port = 3;
}

message RunTaskRequest {
  uint64 job_id = 1;
  uint64 task_id = 2;
  uint64 attempt = 3;
  bytes plan = 4;
  uint64 partition = 5;
  optional string channel = 6;
  repeated WorkerLocation peers = 7;
}

message RunTaskResponse {
}

message StopTaskRequest {
  uint64 job_id = 1;
  uint64 task_id = 2;
  uint64 attempt = 3;
}

message StopTaskResponse {
}

message RemoveStreamRequest {
  string channel_prefix = 1;
}

message RemoveStreamResponse {
}

message StopWorkerRequest {
}

message StopWorkerResponse {
}

service WorkerService {
  rpc RunTask(RunTaskRequest) returns (RunTaskResponse) {}
  rpc StopTask(StopTaskRequest) returns (StopTaskResponse) {}
  rpc RemoveStream(RemoveStreamRequest) returns (RemoveStreamResponse) {}
  rpc StopWorker(StopWorkerRequest) returns (StopWorkerResponse) {}
}
